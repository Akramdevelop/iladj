{% extends "main.html" %} {% load static %} {% block custom_title %} | لوحة
التحكم {% endblock %} {% block custom_css %}
<link rel="stylesheet" href="{% static 'css/bootstrap.css' %}" />
<link rel="stylesheet" href="{% static 'css/style.css' %}" />
<link rel="stylesheet" ² href="{% static 'css/doctorDashboard-style.css' %}" />
{% endblock %} {% block styling %}
<style>
  .modal-title {
    width: 60px;
  }
  .modal-header {
    align-items: center;
  }
  #infos {
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  /* .submit {
    background: rgba(255, 255, 255, 0.7);
    position: fixed;
    bottom: 0;
    padding: .5rem;
  }
  .submit input {
    margin: 0;
    opacity: 1;
  } */
</style>
{% endblock %} {% block content %}
<div class="main-container">
  <div class="left-side">
    <div class="head">
      <!-- deleted -->
      <!-- <div id="searchbydate" class="d-none">
        <input id="getdateinput" type="date" data-enabled="false" />
      </div> -->
      <div style="text-align: center">
        <div style="font-weight: bold"><label id="day"></label></div>
        <div>
          <label id="date" style="width: 100%; text-align: center"></label>
        </div>
        <div id="clock" style="color: blue; font-weight: bold"></div>
      </div>
      <div class="logo-image">
        <a href="{% url 'index' %}">
          <img src="{% static 'images/علاج.jpg' %}" alt="logo" width="120px" />
        </a>
      </div>
      <h3>بيانات الحالة</h3>
    </div>
    <div class="data">
      <form id="savecheckform" data-pkform class="form_1">
        {% csrf_token %}
        <div>
          <label for="_name">الاسم</label>
          <input type="text" id="_name" />
        </div>
        <div>
          <label for="_age">السن</label>
          <input type="text" id="_age" name="age" />
        </div>
        <div>
          <label for="_address">العنوان</label>
          <input type="text" id="_address" name="age" />
        </div>
        <div class="second">
          <div>
            <label for="_work">العمل</label>
            <input type="text" id="_work" name="age" />
          </div>
          <div
            style="display: flex; justify-content: center; align-items: center"
          >
            <label for="smoke" style="margin-left: 5px">مدخن</label>
            <input type="checkbox" id="smoke" name="smoke" />
          </div>
          <div
            style="display: flex; justify-content: center; align-items: center"
          >
            <label for="marry" style="margin-left: 5px">اعزب</label>
            <input type="checkbox" id="marry" name="marry" value="" />
          </div>
          <div>
            <label for="marry_2" style="margin-left: 5px">متزوج</label>
            <input type="checkbox" id="marry_2" name="marry_2" value="" />
          </div>
        </div>

        <div class="information">
          <div
            style="display: flex; justify-content: center; align-items: center"
          >
            <label for="check" style="margin-left: 5px">كشف</label>
            <input type="checkbox" id="check" name="check" />
          </div>
          <div
            style="display: flex; justify-content: center; align-items: center"
          >
            <label for="again" style="margin-left: 5px">اعاده كشف</label>
            <input type="checkbox" id="again" name="again" />
          </div>
          <div
            style="display: flex; justify-content: center; align-items: center"
          >
            <label for="operation" style="margin-left: 5px">متابعة عملية</label>
            <input type="checkbox" id="operation" name="operation" />
          </div>
        </div>

        <div id="infos">
          <div class="info" id="isNewDoc">
            <label
              id="dateLabel"
              for="info"
              style="width: 100%; text-align: center"
            ></label>
            <div>
              <label
                for="info"
                style="display: block; text-align: center; color: blue"
                >التشخيص</label
              >
              <textarea
                style="border: blue 2px solid"
                name="info"
                id="info"
                cols="30"
                rows="8"
                placeholder="التشخيص"
              ></textarea>
            </div>
            <div>
              <label
                for="notes"
                style="display: block; text-align: center; color: blue"
                >ملاحظات</label
              >
              <textarea
                style="border: blue 2px solid"
                name="notes"
                id="notes"
                cols="30"
                rows="8"
                placeholder="ملاحظات"
              ></textarea>
            </div>
            <div class="third_text" style="margin-top: -6px">
              <div style="display: grid; grid-template-columns: 100px 130px">
                <!-- <label for="medicine" style="display: block; text-align: center; color: blue;">الدواء</label> -->
                <label
                  for="med"
                  style="display: block; text-align: center; color: blue"
                  >اختار دواء</label
                >
                <input
                  style="
                    border: blue 2px solid;
                    width: 100%;
                    margin-right: 1rem;
                  "
                  type="text"
                  id="med"
                  list="myDatalist"
                />
                <datalist id="myDatalist"> </datalist>
              </div>
              <textarea
                class="_med"
                style="border: blue 2px solid"
                name="medicine"
                id="medicine"
                cols="30"
                rows="8"
                placeholder="الدواء"
              ></textarea>
            </div>
          </div>
          <div>
            <button style="border: none" id="printMedicine" type="button">
              <i class="fa-solid fa-print" title="طباعة الدواء"></i>
            </button>
          </div>
          <div class="upload-files" style="width: 100%; text-align: center">
            <button
              type="button"
              class="btn btn-success"
              data-bs-toggle="modal"
              data-bs-target="#prescriptionModal"
            >
              الروشته
            </button>
            <!-- Modal -->
            <div
              class="modal fade"
              id="prescriptionModal"
              tabindex="-1"
              role="dialog"
              aria-labelledby="prescriptionModalLabel"
              aria-hidden="true"
            >
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <img
                      class="modal-title ml-2"
                      id="prescriptionModalLabel"
                      src="{% static 'images/picture.png' %}"
                      alt="logo"
                    />
                    <input id="prescriptionImg" type="file" accept="image/*" />
                    <button
                      type="button"
                      class="close"
                      data-bs-dismiss="modal"
                      aria-label="Close"
                    >
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                    <img
                      id="prescriptionPreview"
                      src="{% static 'images/no-image.png' %}"
                      alt="image"
                    />
                  </div>
                  <div class="modal-footer">
                    <button
                      type="button"
                      class="btn btn-secondary"
                      data-bs-dismiss="modal"
                    >
                      Close
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <!-- --------------------------------------------------- -->
            <button
              type="button"
              class="btn btn-success"
              data-bs-toggle="modal"
              data-bs-target="#X-raysModal"
            >
              الاشعة
            </button>
            <!-- Modal -->
            <div
              class="modal fade"
              id="X-raysModal"
              tabindex="-1"
              role="dialog"
              aria-labelledby="X-raysModalLabel"
              aria-hidden="true"
            >
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <img
                      class="modal-title ml-2"
                      id="X-raysModalLabel"
                      src="{% static 'images/picture.png' %}"
                      alt="logo"
                    />
                    <input id="X-raysImg" type="file" accept="image/*" />
                    <button
                      type="button"
                      class="close"
                      data-bs-dismiss="modal"
                      aria-label="Close"
                    >
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                    <a href="{% url 'index' %}">
                      <img
                        id="X-raysPreview"
                        src="{% static 'images/no-image.png' %}"
                        alt="image"
                    /></a>
                  </div>
                  <div class="modal-footer">
                    <button
                      type="button"
                      class="btn btn-secondary"
                      data-bs-dismiss="modal"
                    >
                      Close
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <!-- -------------------------- -->
            <button
              type="button"
              class="btn btn-success"
              data-bs-toggle="modal"
              data-bs-target="#AnalysisModal"
            >
              التحاليل
            </button>

            <!-- Modal -->
            <div
              class="modal fade"
              id="AnalysisModal"
              tabindex="-1"
              role="dialog"
              aria-labelledby="AnalysisModalLabel"
              aria-hidden="true"
            >
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <img
                      class="modal-title ml-2"
                      id="AnalysisModalLabel"
                      src="{% static 'images/picture.png' %}"
                      alt="logo"
                    />
                    <input id="analysisImg" type="file" accept="image/*" />
                    <button
                      type="button"
                      class="close"
                      data-bs-dismiss="modal"
                      aria-label="Close"
                    >
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                    <img
                      id="analysisPreview"
                      src="{% static 'images/no-image.png' %}"
                      alt="image"
                    />
                  </div>
                  <div class="modal-footer">
                    <button
                      type="button"
                      class="btn btn-secondary"
                      data-bs-dismiss="modal"
                    >
                      Close
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <section class="submit">
            <input
              class="btn btn-primary"
              type="submit"
              value="حفظ"
              data-id="savecheckbtn"
            />
            <input
              data-id="add"
              class="btn btn-primary"
              type="button"
              value="اضافة"
              style="margin-right: 5px"
            />
            <input
              type="button"
              data-id="sheetbtn"
              value="شيت"
              class="btn btn-primary"
              style="margin-right: 5px"
            />
            <!-- deleted -->
            <!-- <input
              class="btn btn-primary"
              type="button"
              value="البحث بالتاريخ"
              id="searchbydatebtn"
              style="margin-right: 5px"
            /> -->
          </section>
        </div>
      </form>
    </div>
  </div>
  <div class="right-side">
    <div class="search-box" style="display: flex; justify-content: center">
      <div>
        <form id="formsearchpatient">
          <input
            name="namequery"
            type="text"
            id="searchpatient"
            placeholder="...ابحث باسم المريض"
            style="direction: rtl; padding-right: 10px"
          />
        </form>
      </div>
      <button type="submit" id="sub">ابحث</button>
    </div>
    <section
      class="choice"
      style="
        display: flex;
        justify-content: center;
        direction: rtl;
        gap: 5px;
        overflow: auto;
        flex-wrap: wrap;
        height: 34px;
      "
    >
      {% for assistant in doctor.assistantprofile_set.all %}
      <button
        type="button"
        class="btn btn-secondary btn-sm {% if forloop.first %}selected{% endif %}"
        data-assistant-id="{{ assistant.id }}"
      >
        {{ assistant.clinicName }}
      </button>
      {% endfor %}
    </section>
    <div class="customer" style="margin-top: -10px">
      <form id="namesform" class="second-form">
        <div class="names flex-column justify-content-start" id="names">
          <!-- <a href="" class="btn btn-danger">حذف</a>
          <div class="names flex-column justify-content-start"></div> 
          <button id="names" class="_name" value="submit" style="width: 80%">
            hossam
          </button>
          -->
        </div>
      </form>
    </div>
  </div>
</div>

{% endblock %} {% block custom_js %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<script>
  let updatedcards = null;
  let favoritemedicinesContainer = null;
  function setupdatedcards(value) {
    updatedcards = value || null;
  }
  function setdatalistoptions(index) {
    let i = index || "";
    var datalist = $(`#myDatalist${i}`);
    if (datalist.length) {
      datalist.empty();
      $.each(favoritemedicinesContainer, function (index, medicine) {
        datalist.append('<option value="' + medicine.name + '">');
      });
    }
  }
  function updateIsFinished(patientCardId) {
    $.ajax({
      url: `../accounts/update_is_finished/${patientCardId}/`,
      type: "POST",
      data: {
        csrfmiddlewaretoken: $("input[name=csrfmiddlewaretoken]").val(),
      },
      success: function (response) {
        if (response.success) {
          alert("تم حذف الحالة من القائمة بنجاح");
        } else {
          alert("فشل حذف الحالة، إعد المحاولة أو تواصل مع مسؤولي المنصة");
        }
      },
      error: function () {
        alert("An error occurred while making the request.");
      },
    });
  }
  function addMedicine(medicine) {
    medicinename = medicine;
    $.ajax({
      type: "POST",
      url: `../accounts/addMedicine/`,
      data: {
        medicinename: medicinename,
        csrfmiddlewaretoken: $("input[name=csrfmiddlewaretoken]").val(),
      },
      success: function (response) {
        if (response.success) {
          alert(response.success);
          getMedicines();
        } else {
          console.error(response);
        }
      },
      error: function (xhr, status, error) {
        console.log("Error occurred: ", error);
        console.log("XHR: ", xhr);
      },
    });
  }
  $(document).ready(function () {
    setupdatedcards(null);
    function performsearch() {
      var currentDate = new Date();
      var year = currentDate.getFullYear();
      var month = (currentDate.getMonth() + 1).toString().padStart(2, "0"); // Month is 0-indexed, so add 1
      var day = currentDate.getDate().toString().padStart(2, "0");
      var mydate = year + "-" + month + "-" + day;
      // let customDate = $("#getdateinput").val();
      // let isDateEnable = $("#getdateinput").attr("data-enabled");
      // if (isDateEnable != "false") {
      //   mydate = customDate;
      // }
      var selectedAssistantId = $(".choice button.selected").data(
        "assistant-id"
      );
      $.ajax({
        type: "GET",
        url: "../accounts/searchpatient/",
        data: {
          q: $("#searchpatient").val(),
          date: mydate,
          assistantId: selectedAssistantId,
          csrfmiddlewaretoken: $("input[name=csrfmiddlewaretoken]").val(),
        },
        success: function (response) {
          if (response.success) {
            names = response.success;
            namesContainer = $("#names");
            namesContainer[0].innerHTML = "";
            if (names != "Void") {
              names.forEach((name) => {
                let nameBtn, nameCheck;
                if (name.checked) {
                  nameCheck = "normal";
                } else {
                  nameCheck = "bold";
                }
                namesContainer.append(
                  `<div class="_name align-self-center d-flex justify-content-between align-items-center"><a href="#" class="btn btn-danger" style="height: 30px;margin-top: 5px;display: flex;align-items: center;" onclick="updateIsFinished(${name.id})">حذف</a><button class="text-right btn font-weight-${nameCheck} white-space-normal" type="submit" data-pk="${name.id}">${name.name}</button></div>`
                );
              });
            }
          } else if ("err9" in response) {
            alert("الرجاء ادخال تاريخ صالح");
          } else {
            console.error(response);
          }
        },
        error: function (xhr, status, error) {
          console.log("Error occurred: ", error);
          console.log("XHR: ", xhr);
        },
      });
    }
    performsearch();
    function getpatientdata(patientCardPk) {
      $.ajax({
        type: "GET",
        url: "../accounts/getpatientdata/",
        data: {
          pk: patientCardPk,
          csrfmiddlewaretoken: $("input[name=csrfmiddlewaretoken]").val(),
        },
        success: function (response) {
          clearForm();
          $("#infos").empty();
          if (response.success) {
            patientcard = response.success;
            $("#_work").val(patientcard.work);
            // $("#info").val(doctorcard.diagnosis);
            // $("#notes").val(doctorcard.notes);
            // $("#medicine").val(doctorcard.medicine);
            if (patientcard.isSmoker) {
              $("#smoke").prop("checked", true);
            }
            if (patientcard.isMaried) {
              $("#marry_2").prop("checked", true);
            } else {
              $("#marry").prop("checked", true);
            }
            if (!patientcard.checked) {
              let blueTxtAreas = `<div class="info" id="isNewDoc">
            <label
              id="dateLabel"
              for="info"
              style="width: 100%; text-align: center"
            ></label>
            <div>
              <label
                for="info"
                style="display: block; text-align: center; color: blue"
                >التشخيص</label
              >
              <textarea
                style="border: blue 2px solid"
                name="info"
                id="info"
                cols="30"
                rows="8"
                placeholder="التشخيص"
              ></textarea>
            </div>
            <div>
              <label
                for="notes"
                style="display: block; text-align: center; color: blue"
                >ملاحظات</label
              >
              <textarea
                style="border: blue 2px solid"
                name="notes"
                id="notes"
                cols="30"
                rows="8"
                placeholder="ملاحظات"
              ></textarea>
            </div>
            <div class="third_text" style="margin-top: -6px">
              <div style="display: grid; grid-template-columns: 100px 130px">
                <!-- <label for="medicine" style="display: block; text-align: center; color: blue;">الدواء</label> -->
                <label
                  for="med"
                  style="display: block; text-align: center; color: blue"
                  >اختار دواء</label
                >
                <input
                  style="border: blue 2px solid; width: 100%; margin-right: 1rem"
                  type="text"
                  id="med"
                  list="myDatalist"
                />
                <datalist id="myDatalist">
                </datalist>
              </div>
              <textarea
                class="_med"
                style="border: blue 2px solid"
                name="medicine"
                id="medicine"
                cols="30"
                rows="8"
                placeholder="الدواء"
              ></textarea>
            </div>
          </div>
          <div>
            <button style="border: none;" id="printMedicine" type="button">
              <i class="fa-solid fa-print" title="طباعة الدواء"></i>
            </button>
          </div>
          <div class="upload-files" style="width: 100%; text-align: center">
            <button
              type="button"
              class="btn btn-success"
              data-bs-toggle="modal"
              data-bs-target="#prescriptionModal"
            >
              الروشته
            </button>
            <!-- Modal -->
            <div
              class="modal fade"
              id="prescriptionModal"
              tabindex="-1"
              role="dialog"
              aria-labelledby="prescriptionModalLabel"
              aria-hidden="true"
            >
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <img
                      class="modal-title ml-2"
                      id="prescriptionModalLabel"
                      src="{% static 'images/picture.png' %}"
                      alt="logo"
                    />
                    <input id="prescriptionImg" type="file" accept="image/*" />
                    <button
                      type="button"
                      class="close"
                      data-bs-dismiss="modal"
                      aria-label="Close"
                    >
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                    <img
                      id="prescriptionPreview"
                      src="{% static 'images/no-image.png' %}"
                      alt="image"
                      
                    />
                  </div>
                  <div class="modal-footer">
                    <button
                      type="button"
                      class="btn btn-secondary"
                      data-bs-dismiss="modal"
                    >
                      Close
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <!-- --------------------------------------------------- -->
            <button
              type="button"
              class="btn btn-success"
              data-bs-toggle="modal"
              data-bs-target="#X-raysModal"
            >
              الاشعة
            </button>
            <!-- Modal -->
            <div
              class="modal fade"
              id="X-raysModal"
              tabindex="-1"
              role="dialog"
              aria-labelledby="X-raysModalLabel"
              aria-hidden="true"
            >
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <img
                      class="modal-title ml-2"
                      id="X-raysModalLabel"
                      src="{% static 'images/picture.png' %}"
                      alt="logo"
                    />
                    <input id="X-raysImg" type="file" accept="image/*" />
                    <button
                      type="button"
                      class="close"
                      data-bs-dismiss="modal"
                      aria-label="Close"
                    >
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                    <a href="{% url 'index' %}">
                      <img
                        id="X-raysPreview"
                        src="{% static 'images/no-image.png' %}"
                        alt="image"
                        
                    /></a>
                  </div>
                  <div class="modal-footer">
                    <button
                      type="button"
                      class="btn btn-secondary"
                      data-bs-dismiss="modal"
                    >
                      Close
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <!-- -------------------------- -->
            <button
              type="button"
              class="btn btn-success"
              data-bs-toggle="modal"
              data-bs-target="#AnalysisModal"
            >
              التحاليل
            </button>

            <!-- Modal -->
            <div
              class="modal fade"
              id="AnalysisModal"
              tabindex="-1"
              role="dialog"
              aria-labelledby="AnalysisModalLabel"
              aria-hidden="true"
            >
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <img
                      class="modal-title ml-2"
                      id="AnalysisModalLabel"
                      src="{% static 'images/picture.png' %}"
                      alt="logo"
                    />
                    <input id="analysisImg" type="file" accept="image/*" />
                    <button
                      type="button"
                      class="close"
                      data-bs-dismiss="modal"
                      aria-label="Close"
                    >
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                    <img
                      id="analysisPreview"
                      src="{% static 'images/no-image.png' %}"
                      alt="image"
                      
                    />
                  </div>
                  <div class="modal-footer">
                    <button
                      type="button"
                      class="btn btn-secondary"
                      data-bs-dismiss="modal"
                    >
                      Close
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <section class="submit">
            <input
              class="btn btn-primary"
              type="submit"
              value="حفظ"
              data-id="savecheckbtn"
            />
            <input
              data-id="add"
              class="btn btn-primary"
              type="button"
              value="اضافة"
              style="margin-right: 5px"
            />
            <input
              type="button"
              data-id="sheetbtn"
              value="شيت"
              class="btn btn-primary"
              style="margin-right: 5px"
            />
            <!-- deleted -->
            <!-- <input
              class="btn btn-primary"
              type="button"
              value="البحث بالتاريخ"
              id="searchbydatebtn"
              style="margin-right: 5px"
            /> -->
          </section>`;
              $("#infos").append($(blueTxtAreas));

              printEvent("");
              setupEventHandler();
              setupChangeEventHandler("prescription");
              setupChangeEventHandler("X-rays");
              setupChangeEventHandler("analysis");
              setupaddevent();
              setupsheetevent();
              if (response.favoritemedicines) {
                favoritemedicinesContainer = response.favoritemedicines;
                setdatalistoptions("");
              }
              const currentDate = new Date(
                new Date().toLocaleString("en-US", { timeZone: "Africa/Cairo" })
              );
              getDateLabel(currentDate);
            }
            if (patientcard.type == "check") {
              $("#check").prop("checked", true);
            } else if (patientcard.type == "recheck") {
              $("#again").prop("checked", true);
            } else if (patientcard.type == "operation") {
              $("#operation").prop("checked", true);
            }
            if (response.doctorcards) {
              let doctorcards = response.doctorcards;
              $("#infos").attr(
                "data-updatablecardslength",
                response.updatabledoctorcards.length
              );
              updatedcards = response.updatabledoctorcards;
              for (var i = 0; i < response.doctorcards.length; i++) {
                var doctorcard = doctorcards[i];
                let cardHTML = `
  <div class="info">
    <label
      id="dateLabel${doctorcard.id}"
      for="info"
      style="width: 100%; text-align: center"
    ></label>
    <div>
      <label
        for="info${doctorcard.id}"
        style="display: block; text-align: center; color: darkcyan"
        >التشخيص</label
      >
      <textarea
        style="border: darkcyan 2px solid"
        name="info${doctorcard.id}"
        id="info${doctorcard.id}"
        cols="30"
        rows="8"
        placeholder="التشخيص"
      ></textarea>
      </div>
      <div>
        <label
          for="notes${doctorcard.id}"
          style="display: block; text-align: center; color: darkcyan"
          >ملاحظات</label
        >
        <textarea
          style="border: darkcyan 2px solid"
          name="notes${doctorcard.id}"
          id="notes${doctorcard.id}"
          cols="30"
          rows="8"
          placeholder="ملاحظات"
        ></textarea>
      </div>
      <div class="third_text" style="margin-top: -6px">
        <div style="display: grid; grid-template-columns: 100px 130px">
          <!-- <label for="medicine" style="display: block; text-align: center; color: darkcyan;">الدواء</label> -->
          <label
            for="med${doctorcard.id}"
            style="display: block; text-align: center; color: darkcyan"
            >اختار دواء</label
          >
          <input
            style="border: darkcyan 2px solid; width: 100%; margin-right: 1rem"
            type="text"
            id="med${doctorcard.id}"
            list="myDatalist${doctorcard.id}"
          />
          <datalist id="myDatalist${doctorcard.id}">
            <option value="Option 1"></option>
            <option value="Option 2"></option>
            <option value="Option 3"></option>
            <option value="Option 4"></option>
            <option value="Option 5"></option>
          </datalist>
        </div>
        <textarea
          style="border: darkcyan 2px solid"
          name="medicine${doctorcard.id}"
          id="medicine${doctorcard.id}"
          cols="30"
          rows="8"
          placeholder="الدواء"
        ></textarea>
      </div>
  </div>
    <div>
      <button style="border: none;" id="printMedicine${
        doctorcard.id
      }" type="button">
        <i class="fa-solid fa-print" title="طباعة الدواء"></i>
      </button>
    </div>
  <div class="upload-files" style="width: 100%; text-align: center">
    <button
      type="button"
      class="btn btn-success"
      data-bs-toggle="modal"
      data-bs-target="#prescriptionModal${doctorcard.id}"
    >
      الروشته
    </button>
    <!-- Modal -->
    <div
      class="modal fade"
      id="prescriptionModal${doctorcard.id}"
      tabindex="-1"
      role="dialog"
      aria-labelledby="prescriptionModalLabel${doctorcard.id}"
      aria-hidden="true"
    >
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <img
              class="modal-title ml-2"
              id="prescriptionModalLabel${doctorcard.id}"
              src="{% static 'images/picture.png' %}"
              alt="logo"
            />
            <input id="prescriptionImg${
              doctorcard.id
            }" type="file" accept="image/*" />
            <button
              type="button"
              class="close"
              data-bs-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <img
              id="prescriptionPreview${doctorcard.id}"
              src="${
                doctorcard.prescription !== null
                  ? doctorcard.prescription
                  : "{% static 'images/no-image.png' %}"
              }"
              alt="image"
              
            />
            <div class="w-100 text-center font-weight-bold h3 mt-5">${
              doctorcard.prescription !== null ? "" : "لا توجد أي صور"
            }</div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>

          </div>
        </div>
      </div>
    </div>
    <!-- --------------------------------------------------- -->
    <button
      type="button"
      class="btn btn-success"
      data-bs-toggle="modal"
      data-bs-target="#X-raysModal${doctorcard.id}"
    >
      الاشعة
    </button>
    <!-- Modal -->
    <div
      class="modal fade"
      id="X-raysModal${doctorcard.id}"
      tabindex="-1"
      role="dialog"
      aria-labelledby="X-raysModalLabel${doctorcard.id}"
      aria-hidden="true"
    >
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <img
              class="modal-title ml-2"
              id="X-raysModalLabel${doctorcard.id}"
              src="{% static 'images/picture.png' %}"
              alt="logo"
            />
            <input id="X-raysImg${
              doctorcard.id
            }" type="file" accept="image/*" />
            <button
              type="button"
              class="close"
              data-bs-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <img
              id="X-raysPreview${doctorcard.id}"
              src="${
                doctorcard.xRays !== null
                  ? doctorcard.xRays
                  : "{% static 'images/no-image.png' %}"
              }"
              alt="image"
              
            />
            <div class="w-100 text-center font-weight-bold h3 mt-5">${
              doctorcard.xRays !== null ? "" : "لا توجد أي صور"
            }</div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>

          </div>
        </div>
      </div>
    </div>
    <!-- -------------------------- -->
    <button
      type="button"
      class="btn btn-success"
      data-bs-toggle="modal"
      data-bs-target="#AnalysisModal${doctorcard.id}"
    >
      التحاليل
    </button>

    <!-- Modal -->
    <div
      class="modal fade"
      id="AnalysisModal${doctorcard.id}"
      tabindex="-1"
      role="dialog"
      aria-labelledby="AnalysisModalLabel${doctorcard.id}"
      aria-hidden="true"
    >
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <img
              class="modal-title ml-2"
              id="AnalysisModalLabel${doctorcard.id}"
              src="{% static 'images/picture.png' %}"
              alt="logo"
            />
            <input id="analysisImg${
              doctorcard.id
            }" type="file" accept="image/*" />
            <button
              type="button"
              class="close"
              data-bs-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <img
              id="analysisPreview${doctorcard.id}"
              src="${
                doctorcard.analysis !== null
                  ? doctorcard.analysis
                  : "{% static 'images/no-image.png' %}"
              }"
              alt="image"
              
            />
            <div class="w-100 text-center font-weight-bold h3 mt-5">${
              doctorcard.analysis !== null ? "" : "لا توجد أي صور"
            }</div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>

          </div>
        </div>
      </div>
    </div>
  </div>
          <section class="submit">
            <input
              class="btn btn-primary"
              type="submit"
              value="حفظ"
              data-id="savecheckbtn"
            />
            <input
              data-id="add"
              class="btn btn-primary"
              type="button"
              value="اضافة"
              style="margin-right: 5px"
            />
            <input
              type="button"
              data-id="sheetbtn"
              value="شيت"
              class="btn btn-primary"
              style="margin-right: 5px"
            />
            <!-- deleted -->
            <!-- <input
              class="btn btn-primary"
              type="button"
              value="البحث بالتاريخ"
              id="searchbydatebtn"
              style="margin-right: 5px"
            /> -->
          </section>`;
                $("#infos").append($(cardHTML));
                setupaddevent();
                setupsheetevent();
                printEvent(doctorcard.id);
                setupEventHandler(doctorcard.id);
                setupChangeEventHandler("prescription", doctorcard.id);
                setupChangeEventHandler("X-rays", doctorcard.id);
                setupChangeEventHandler("analysis", doctorcard.id);
                $(`#info${doctorcard.id}`).val(doctorcard.diagnosis);
                $(`#notes${doctorcard.id}`).val(doctorcard.notes);
                $(`#medicine${doctorcard.id}`).val(doctorcard.medicine);
                $(`#dateLabel${doctorcard.id}`).text(doctorcard.date);
                if (response.favoritemedicines) {
                  favoritemedicinesContainer = response.favoritemedicines;
                  setdatalistoptions(doctorcard.id);
                }
              }
            }
            if (response.tempdoctorcard) {
              if (response.tempdoctorcard.prescription != null) {
                $("#prescriptionPreview").attr(
                  "src",
                  response.tempdoctorcard.prescription
                );
                $("#prescriptionPreview").attr(
                  "data-srcfromassistant",
                  response.tempdoctorcard.prescription
                );
              }
              if (response.tempdoctorcard.xRays != null) {
                $("#X-raysPreview").attr("src", response.tempdoctorcard.xRays);
                $("#X-raysPreview").attr(
                  "data-srcfromassistant",
                  response.tempdoctorcard.xRays
                );
              }
              if (response.tempdoctorcard.analysis != null) {
                $("#analysisPreview").attr(
                  "src",
                  response.tempdoctorcard.analysis
                );
                $("#analysisPreview").attr(
                  "data-srcfromassistant",
                  response.tempdoctorcard.analysis
                );
              }
            }
            if (response.favoritemedicines) {
              favoritemedicinesContainer = response.favoritemedicines;
              setdatalistoptions("");
            }
            patientCard = response.success;
            $("#_name").val(patientCard.name);
            $("#_age").val(patientCard.age);
            $("#_address").val(patientCard.address);
            $("#savecheckform").attr("data-pkform", patientCard.id);
            checkPK();
          } else {
            console.error(response);
          }
        },
        error: function (xhr, status, error) {
          console.log("Error occurred: ", error);
          console.log("XHR: ", xhr);
        },
      });
    }
    $("#formsearchpatient").on("keyup", function (e) {
      performsearch();
    });
    $(document).on("submit", "#namesform", function (e) {
      e.preventDefault();
      let submittedbtn = $(this)
        .find('input[type="submit"], button[type="submit"]')
        .filter(":focus");
      let patientCardPk = submittedbtn.data("pk");
      getpatientdata(patientCardPk);
    });
    $(document).on("submit", "#savecheckform", function (e) {
      e.preventDefault();
      let patientCardPk = $("#savecheckform").attr("data-pkform");
      if (patientCardPk) {
        var formData = new FormData();
        let prescriptionOrigin;
        let xRaysOrigin;
        let analysisOrigin;
        if ($("#prescriptionImg").length > 0) {
          prescriptionOrigin = $("#prescriptionImg")[0].files[0];
        } else {
          prescriptionOrigin = "empty";
        }
        if ($("#X-raysImg").length > 0) {
          xRaysOrigin = $("#X-raysImg")[0].files[0];
        } else {
          xRaysOrigin = "empty";
        }
        if ($("#analysisImg").length > 0) {
          analysisOrigin = $("#analysisImg")[0].files[0];
        } else {
          analysisOrigin = "empty";
        }
        let data = {
          patientcardpk: patientCardPk,
          work: $("#_work").val(),
          name: $("#_name").val(),
          age: $("#_age").val(),
          address: $("#_address").val(),
          smoke: $("#smoke").is(":checked"),
          marry: $("#marry").is(":checked"),
          marry2: $("#marry_2").is(":checked"),
          check: $("#check").is(":checked"),
          again: $("#again").is(":checked"),
          operation: $("#operation").is(":checked"),
          info: $("#info").val(),
          notes: $("#notes").val(),
          medicine: $("#medicine").val(),
          prescription: prescriptionOrigin,
          xRays: xRaysOrigin,
          analysis: analysisOrigin,
          savecheckbtn: 0,
          addbtn: 0,
          csrfmiddlewaretoken: $("input[name=csrfmiddlewaretoken]").val(),
        };
        let submittedbtn = $(this)
          .find('input[type="submit"], button[type="submit"]')
          .filter(":focus");
        if (submittedbtn.attr("data-id") == "savecheckbtn") {
          data.savecheckbtn = 1;
          data.addbtn = 0;
        } else if (submittedbtn.attr("data-id") == "add") {
          data.savecheckbtn = 0;
          data.addbtn = 1;
        }
        for (var key in data) {
          if (data.hasOwnProperty(key)) {
            formData.append(key, data[key]);
          }
        }
        formData.append(
          "updatablecardslength",
          $("#infos").attr("data-updatablecardslength")
        );
        for (
          let index = 0;
          index < parseInt($("#infos").attr("data-updatablecardslength"));
          index++
        ) {
          formData.append(`doctorcard${index}id`, updatedcards[index].id);
          formData.append(
            `info${index}`,
            $(`#info${updatedcards[index].id}`).val()
          );
          formData.append(
            `notes${index}`,
            $(`#notes${updatedcards[index].id}`).val()
          );
          formData.append(
            `medicine${index}`,
            $(`#medicine${updatedcards[index].id}`).val()
          );
          formData.append(
            `prescriptionImg${index}`,
            $(`#prescriptionImg${updatedcards[index].id}`)[0].files[0]
          );
          formData.append(
            `X-raysImg${index}`,
            $(`#X-raysImg${updatedcards[index].id}`)[0].files[0]
          );
          formData.append(
            `analysisImg${index}`,
            $(`#analysisImg${updatedcards[index].id}`)[0].files[0]
          );
        }

        if (
          $("#prescriptionPreview").attr("src") !=
          $("#prescriptionPreview").attr("data-srcfromassistant")
        ) {
          formData.append("prescriptionImg", $("#prescriptionImg")[0].files[0]);
        } else if ($("#prescriptionImg").length <= 0) {
          formData.append("prescriptionImg", "empty");
        } else {
          formData.append("prescriptionImg", "sameAsTemp");
        }
        if (
          $("#X-raysPreview").attr("src") !=
          $("#X-raysPreview").attr("data-srcfromassistant")
        ) {
          formData.append("X-raysImg", $("#X-raysImg")[0].files[0]);
        } else if ($("#X-raysImg").length <= 0) {
          formData.append("X-raysImg", "empty");
        } else {
          formData.append("X-raysImg", "sameAsTemp");
        }
        if (
          $("#analysisPreview").attr("src") !=
          $("#analysisPreview").attr("data-srcfromassistant")
        ) {
          formData.append("analysisImg", $("#analysisImg")[0].files[0]);
        } else if ($("#analysisImg").length <= 0) {
          formData.append("analysisImg", "empty");
        } else {
          formData.append("analysisImg", "sameAsTemp");
        }
        if ($("#isNewDoc").length > 0) {
          formData.append("isnewdoc", "1");
        } else {
          formData.append("isnewdoc", "0");
        }

        $.ajax({
          type: "POST",
          url: "../accounts/setdoctordata/",
          data: formData,
          contentType: false,
          processData: false,
          success: function (response) {
            if (response.success) {
              alert(response.success);
              checkPK();
              performsearch();
              getpatientdata(patientCardPk);
            } else if (response.err8) {
              alert("خطأ في اختيار نوع التشخيص");
            } else if (response.err10) {
              alert("خطأ في اختيار الحالة العائلية");
            } else {
              console.error(response);
            }
          },
          error: function (xhr, status, error) {
            console.log("Error occurred: ", error);
            console.log("XHR: ", xhr);
          },
        });
      } else {
        alert("أنت لم تحدد أي مريض");
      }
    });
    function setupsheetevent() {
      $('[data-id="sheetbtn"]').on("click", function (e) {
        if ($("#savecheckform").attr("data-pkform")) {
          var url = "/sheet/" + $("#savecheckform").attr("data-pkform") + "/";

          // Redirect to the URL
          window.location.href = url;
        }
      });
    }
    setupsheetevent();
    // Function to clear the input field
    $("#searchbydatebtn").on("click", function (e) {
      $("#searchbydate").toggleClass("d-none");
      // Get the current value of the "data-enabled" attribute
      var currentValue = $("#getdateinput").attr("data-enabled");

      // Toggle the value between "true" and "false"
      var newValue = currentValue === "true" ? "false" : "true";

      // Set the new value for the "data-enabled" attribute
      $("#getdateinput").attr("data-enabled", newValue);
    });
    function setupaddevent() {
      $('[data-id="add"]').on("click", function (e) {
        if ($("#infos").find("#info").length <= 0) {
          let blueTxtAreas = `<div class="info" id="isNewDoc">
              <label
                id="dateLabel"
                for="info"
                style="width: 100%; text-align: center"
              ></label>
              <div>
                <label
                  for="info"
                  style="display: block; text-align: center; color: blue"
                  >التشخيص</label
                >
                <textarea
                  style="border: blue 2px solid"
                  name="info"
                  id="info"
                  cols="30"
                  rows="8"
                  placeholder="التشخيص"
                ></textarea>
              </div>
              <div>
                <label
                  for="notes"
                  style="display: block; text-align: center; color: blue"
                  >ملاحظات</label
                >
                <textarea
                  style="border: blue 2px solid"
                  name="notes"
                  id="notes"
                  cols="30"
                  rows="8"
                  placeholder="ملاحظات"
                ></textarea>
              </div>
              <div class="third_text" style="margin-top: -6px">
                <div style="display: grid; grid-template-columns: 100px 130px">
                  <!-- <label for="medicine" style="display: block; text-align: center; color: blue;">الدواء</label> -->
                  <label
                    for="med"
                    style="display: block; text-align: center; color: blue"
                    >اختار دواء</label
                  >
                  <input
                    style="border: blue 2px solid; width: 100%; margin-right: 1rem"
                    type="text"
                    id="med"
                    list="myDatalist"
                  />
                  <datalist id="myDatalist">
                  </datalist>
                </div>
                <textarea
                  class="_med"
                  style="border: blue 2px solid"
                  name="medicine"
                  id="medicine"
                  cols="30"
                  rows="8"
                  placeholder="الدواء"
                ></textarea>
              </div>
            </div>
            <div>
              <button style="border: none;" id="printMedicine" type="button">
                <i class="fa-solid fa-print" title="طباعة الدواء"></i>
              </button>
            </div>
            <div class="upload-files" style="width: 100%; text-align: center">
              <button
                type="button"
                class="btn btn-success"
                data-bs-toggle="modal"
                data-bs-target="#prescriptionModal"
              >
                الروشته
              </button>
              <!-- Modal -->
              <div
                class="modal fade"
                id="prescriptionModal"
                tabindex="-1"
                role="dialog"
                aria-labelledby="prescriptionModalLabel"
                aria-hidden="true"
              >
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <img
                        class="modal-title ml-2"
                        id="prescriptionModalLabel"
                        src="{% static 'images/picture.png' %}"
                        alt="logo"
                      />
                      <input id="prescriptionImg" type="file" accept="image/*" />
                      <button
                        type="button"
                        class="close"
                        data-bs-dismiss="modal"
                        aria-label="Close"
                      >
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">
                      <img
                        id="prescriptionPreview"
                        src="{% static 'images/no-image.png' %}"
                        alt="image"
                        
                      />
                    </div>
                    <div class="modal-footer">
                      <button
                        type="button"
                        class="btn btn-secondary"
                        data-bs-dismiss="modal"
                      >
                        Close
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              <!-- --------------------------------------------------- -->
              <button
                type="button"
                class="btn btn-success"
                data-bs-toggle="modal"
                data-bs-target="#X-raysModal"
              >
                الاشعة
              </button>
              <!-- Modal -->
              <div
                class="modal fade"
                id="X-raysModal"
                tabindex="-1"
                role="dialog"
                aria-labelledby="X-raysModalLabel"
                aria-hidden="true"
              >
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <img
                        class="modal-title ml-2"
                        id="X-raysModalLabel"
                        src="{% static 'images/picture.png' %}"
                        alt="logo"
                      />
                      <input id="X-raysImg" type="file" accept="image/*" />
                      <button
                        type="button"
                        class="close"
                        data-bs-dismiss="modal"
                        aria-label="Close"
                      >
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">
                      <a href="{% url 'index' %}">
                        <img
                          id="X-raysPreview"
                          src="{% static 'images/no-image.png' %}"
                          alt="image"
                          
                      /></a>
                    </div>
                    <div class="modal-footer">
                      <button
                        type="button"
                        class="btn btn-secondary"
                        data-bs-dismiss="modal"
                      >
                        Close
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              <!-- -------------------------- -->
              <button
                type="button"
                class="btn btn-success"
                data-bs-toggle="modal"
                data-bs-target="#AnalysisModal"
              >
                التحاليل
              </button>

              <!-- Modal -->
              <div
                class="modal fade"
                id="AnalysisModal"
                tabindex="-1"
                role="dialog"
                aria-labelledby="AnalysisModalLabel"
                aria-hidden="true"
              >
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <img
                        class="modal-title ml-2"
                        id="AnalysisModalLabel"
                        src="{% static 'images/picture.png' %}"
                        alt="logo"
                      />
                      <input id="analysisImg" type="file" accept="image/*" />
                      <button
                        type="button"
                        class="close"
                        data-bs-dismiss="modal"
                        aria-label="Close"
                      >
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">
                      <img
                        id="analysisPreview"
                        src="{% static 'images/no-image.png' %}"
                        alt="image"
                        
                      />
                    </div>
                    <div class="modal-footer">
                      <button
                        type="button"
                        class="btn btn-secondary"
                        data-bs-dismiss="modal"
                      >
                        Close
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <section class="submit">
              <input
                class="btn btn-primary"
                type="submit"
                value="حفظ"
                data-id="savecheckbtn"
              />
              <input
                data-id="add"
                class="btn btn-primary"
                type="button"
                value="اضافة"
                style="margin-right: 5px"
              />
              <input
                type="button"
                data-id="sheetbtn"
                value="شيت"
                class="btn btn-primary"
                style="margin-right: 5px"
              />
              <!-- deleted -->
              <!-- <input
                class="btn btn-primary"
                type="button"
                value="البحث بالتاريخ"
                id="searchbydatebtn"
                style="margin-right: 5px"
              /> -->
            </section>`;
          $("#infos").prepend($(blueTxtAreas));
          setupaddevent();
          setupsheetevent();
          printEvent("");
          setupEventHandler();
          setupChangeEventHandler("prescription");
          setupChangeEventHandler("X-rays");
          setupChangeEventHandler("analysis");
          if (favoritemedicinesContainer != null) {
            setdatalistoptions("");
          }
        }
        $(".left-side").animate({ scrollTop: 0 }, "slow");
        const currentDate = new Date(
          new Date().toLocaleString("en-US", { timeZone: "Africa/Cairo" })
        );
        getDateLabel(currentDate);
      });
    }
    setupaddevent();
    function clearForm() {
      $("#_name").val("");
      $("#_age").val("");
      $("#_address").val("");
      $("#_work").val("");
      $("#smoke").val("");
      $("#marry").val("");
      $("#marry_2").val("");
      $("#info").val("");
      $("#notes").val("");
      $("#medicine").val("");
      $("#operation").prop("checked", false);
      $("#again").prop("checked", false);
      $("#check").prop("checked", false);
      $("#marry").prop("checked", false);
      $("#marry_2").prop("checked", false);
      $("#smoke").prop("checked", false);
      $("#prescriptionImg").val("");
      $("#prescriptionPreview").attr(
        "src",
        "{% static 'images/no-image.png' %}"
      );
      $("#X-raysImg").val("");
      $("#X-raysPreview").attr("src", "{% static 'images/no-image.png' %}");
      $("#analysisImg").val("");
      $("#analysisPreview").attr("src", "{% static 'images/no-image.png' %}");
    }
    function checkPK() {
      let pk = $("#savecheckform").attr("data-pkform");
      if (!pk) {
        clearForm();
      }
    }
    setInterval(checkPK, 1000);
    setInterval(performsearch, 1000);

    const buttons = document.querySelectorAll(".choice button");

    buttons.forEach((button) => {
      button.addEventListener("click", () => {
        // Remove the 'selected' class from all buttons
        buttons.forEach((btn) => btn.classList.remove("selected"));

        // Add the 'selected' class to the clicked button
        button.classList.add("selected");

        performsearch();
      });
    });

    // $("#prescriptionImg").change(function () {
    //   var input = this;
    //   var previewImage = $("#prescriptionPreview");
    //   console.log("here");
    //   if (input.files && input.files[0]) {
    //     var reader = new FileReader();

    //     reader.onload = function (e) {
    //       // Update the 'src' attribute of the <img> tag to display the selected image
    //       previewImage.attr("src", e.target.result);
    //     };

    //     reader.readAsDataURL(input.files[0]);
    //   } else {
    //     // Clear the <img> tag if no file is selected
    //     previewImage.attr("src", "{% static 'images/no-image.png' %}");
    //   }
    // });
    // $("#X-raysImg").change(function () {
    //   var input = this;
    //   var previewImage = $("#X-raysPreview");

    //   if (input.files && input.files[0]) {
    //     var reader = new FileReader();

    //     reader.onload = function (e) {
    //       // Update the 'src' attribute of the <img> tag to display the selected image
    //       previewImage.attr("src", e.target.result);
    //     };

    //     reader.readAsDataURL(input.files[0]);
    //   } else {
    //     // Clear the <img> tag if no file is selected
    //     previewImage.attr("src", "{% static 'images/no-image.png' %}");
    //   }
    // });
    // $("#analysisImg").change(function () {
    //   var input = this;
    //   var previewImage = $("#analysisPreview");

    //   if (input.files && input.files[0]) {
    //     var reader = new FileReader();

    //     reader.onload = function (e) {
    //       // Update the 'src' attribute of the <img> tag to display the selected image
    //       previewImage.attr("src", e.target.result);
    //     };

    //     reader.readAsDataURL(input.files[0]);
    //   } else {
    //     // Clear the <img> tag if no file is selected
    //     previewImage.attr("src", "{% static 'images/no-image.png' %}");
    //   }
    // });

    function setupEventHandler(doctorcardid) {
      let doctorcardId = doctorcardid || "";
      // $(`#med${doctorcardId}`).on("input", function (event) {
      //   let selectedvalue = $(`#med${doctorcardId}`).val();
      //   let datalist = $(`#myDatalist${doctorcardId}`);
      //   let options = datalist.find("option");
      //   let optionValues = [];
      //   options.each(function () {
      //     optionValues.push($(this).val());
      //   });
      //   if ($.inArray(selectedvalue, optionValues) !== -1) {
      //     $(`#medicine${doctorcardId}`).val(
      //       $(`#medicine${doctorcardId}`).val() + selectedvalue + "،\n"
      //     );
      //     $(`#med${doctorcardId}`).val("");
      //   }
      //   // else {
      //   //   if (event.keyCode === 13) {
      //   //     addMedicine(selectedvalue);
      //   //     $(`#medicine${doctorcardId}`).val(
      //   //       $(`#medicine${doctorcardId}`).val() + selectedvalue + "،\n"
      //   //     );
      //   //     $(`#med${doctorcardId}`).val("");
      //   //   }
      //   // }
      // });
      $(`#med${doctorcardId}`).on("keydown", function (event) {
        let selectedvalue = $(`#med${doctorcardId}`).val();
        let datalist = $(`#myDatalist${doctorcardId}`);
        let options = datalist.find("option");
        let optionValues = [];
        options.each(function () {
          optionValues.push($(this).val());
        });

        if (event.keyCode === 13) {
          if ($.inArray(selectedvalue, optionValues) !== -1) {
            $(`#medicine${doctorcardId}`).val(
              $(`#medicine${doctorcardId}`).val() + selectedvalue + "،\n"
            );
            $(`#med${doctorcardId}`).val("");
          } else {
            addMedicine(selectedvalue);
            $(`#medicine${doctorcardId}`).val(
              $(`#medicine${doctorcardId}`).val() + selectedvalue + "،\n"
            );
            $(`#med${doctorcardId}`).val("");
          }
        }
      });
    }
    function setupChangeEventHandler(type, id) {
      let pk = id || "";
      $(`#${type}Img${pk}`).change(function () {
        var input = this;
        var previewImage = $(`#${type}Preview${pk}`);
        if (input.files && input.files[0]) {
          var reader = new FileReader();

          reader.onload = function (e) {
            // Update the 'src' attribute of the <img> tag to display the selected image
            previewImage.attr("src", e.target.result);
          };

          reader.readAsDataURL(input.files[0]);
        } else {
          // Clear the <img> tag if no file is selected
          previewImage.attr("src", "{% static 'images/no-image.png' %}");
        }
      });
    }
    function printEvent(id) {
      $(`#printMedicine${id}`).on("click", function (event) {
        let TextAreaValue = $(`#medicine${id}`).val();
        let valueToPrint = TextAreaValue.replace(/\n/g, "<br>");
        var printWindow = window.open("", "", "width=600,height=600");
        printWindow.document.open();
        printWindow.document.write(
          "<html><body>" + valueToPrint + "</body></html>"
        );
        printWindow.document.close();
        printWindow.print();
        printWindow.close();
      });
    }
    printEvent("");
    setupEventHandler();
    setupChangeEventHandler("prescription");
    setupChangeEventHandler("X-rays");
    setupChangeEventHandler("analysis");
  });
</script>
<script src="{% static 'js/bootstrap.bundle.js' %}"></script>
<script>
  const date = document.getElementById("date");
  const currentDate = new Date(
    new Date().toLocaleString("en-US", { timeZone: "Africa/Cairo" })
  );
  const dateFunction = () => {
    const day = currentDate.getDate();
    const month = currentDate.getMonth() + 1; // Months are zero-based, so add 1
    const year = currentDate.getFullYear();
    const watch = currentDate.getHours();
    const formattedDate = `${day}/${month}/${year}`;
    date.textContent = formattedDate;
  };
  dateFunction();
  function currentTime() {
    let date = new Date();
    let hh = date.getHours();
    let mm = date.getMinutes();
    let ss = date.getSeconds();
    let session = "AM";
    if (hh == 0) {
      hh = 12;
    }
    if (hh > 12) {
      hh = hh - 12;
      session = "PM";
    }
    hh = hh < 10 ? "0" + hh : hh;
    mm = mm < 10 ? "0" + mm : mm;
    ss = ss < 10 ? "0" + ss : ss;

    let time = hh + ":" + mm + ":" + ss + " " + session;
    document.getElementById("clock").innerText = time;
    let t = setTimeout(function () {
      currentTime();
    }, 1000);
  }
  currentTime();
  const day = () => {
    let label_day = document.getElementById("day");
    const daysOfWeek = [
      "Sunday",
      "Monday",
      "Tuesday",
      "Wednesday",
      "Thursday",
      "Friday",
      "Saturday",
    ];
    const _day = currentDate.getDay();
    label_day.textContent = daysOfWeek[_day];
  };
  day();
  function getDateLabel(currentDate) {
    const akday = String(currentDate.getDate()).padStart(2, "0");
    const akmonth = String(currentDate.getMonth() + 1).padStart(2, "0"); // Months are 0-indexed, so we add 1
    const akyear = currentDate.getFullYear();
    const akformattedDate = `${akday}-${akmonth}-${akyear}`;
    let labelday = document.getElementById("dateLabel");
    labelday.textContent = akformattedDate;
  }
  getDateLabel(currentDate);
</script>
{% endblock %}
